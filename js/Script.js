    var canvas;
    var imgObj, image, paths = [], text;
    var logo, body, border;
    var swatches;
    
    function init() {
        canvas = new fabric.Canvas('canvas');
        fabric.Object.prototype.transparentCorners = false;

        imgObj = new Image();
        imgObj.src = 'https://dl.kraken.io/web/bb/a15acd153af2d7fb7acea05f7cb801/shirt-mask-black.png';
        imgObj.onload = function () {
            image = new fabric.Image(imgObj);
            image.set({ selectable: false });
            canvas.setHeight(image.getHeight());
            canvas.setWidth(image.getWidth());
            canvas.add(image);
            canvas.moveTo(image, 0);
        }

        logo = new fabric.Path('m 122,157.36656 c 0,-0.8984 1.575,-4.72394 3.5,-8.50121 1.925,-3.77727 3.5,-7.53364 3.5,-8.3475 0,-1.64341 4.26645,-3.08924 5.98384,-2.02784 0.60363,0.37307 0.81923,1.55509 0.47911,2.62672 -0.60459,1.90489 -0.54408,1.9031 2.70933,-0.0804 3.50484,-2.13682 7.32609,-2.65699 8.27225,-1.12606 0.30942,0.50064 -1.03778,3.92689 -2.99377,7.61388 -1.95599,3.68699 -3.34613,6.91383 -3.0892,7.17076 C 142.15496,156.4883 152,144.71962 152,140.7824 c 0,-2.07889 4.64216,-3.54024 6.22331,-1.95909 0.76917,0.76917 0.007,3.11233 -2.66637,8.20029 -2.05879,3.91788 -3.51487,7.3518 -3.23574,7.63093 1.05266,1.05266 4.70697,-1.83671 7.48665,-5.91952 2.84543,-4.17937 10.4105,-18.58511 11.54529,-21.98501 0.63427,-1.90034 5.10345,-2.43828 6.15269,-0.74057 0.34312,0.55518 -1.24398,4.39311 -3.52689,8.52872 l -4.15074,7.5193 4.02363,-2.09724 c 3.19849,-1.66714 4.44655,-1.87089 6.0859,-0.99354 4.33888,2.3221 1.70199,8.646 -5.03913,12.08506 -4.1929,2.13906 -4.37766,3.94827 -0.4032,3.94827 2.3139,0 4.41145,-1.8378 13.41073,-11.75 3.32655,-3.66401 4.41647,-4.25 7.90479,-4.25 5.3769,0 7.48012,2.15091 7.00233,7.1611 -0.41652,4.3676 0.55193,4.78391 3.8723,1.66459 1.27295,-1.19588 2.31445,-1.72432 2.31445,-1.17432 0,1.45491 -4.13404,5.00778 -6.75,5.80108 -1.2375,0.37528 -2.25,1.0653 -2.25,1.53338 C 200,155.5817 193.27268,159 190.13197,159 186.71236,159 183,156.03973 183,153.31291 c 0,-1.36999 -0.51689,-1.20499 -2.75,0.87781 -5.49767,5.12764 -11.33015,6.39656 -13.21482,2.87502 -1.6943,-3.16584 -1.20247,-4.75381 1.86604,-6.02483 4.36225,-1.8069 7.77317,-5.76652 6.26586,-7.27383 -2.17749,-2.17749 -6.40206,1.43189 -10.0565,8.59203 -2.80122,5.48844 -3.8193,6.64089 -5.86658,6.64089 -2.08565,0 -2.40356,-0.38496 -2.01153,-2.43575 l 0.46562,-2.43576 -3.29407,2.51251 c -3.98446,3.0391 -7.76179,2.86039 -8.22331,-0.38904 l -0.3193,-2.24804 -3.27509,2.49804 c -3.56284,2.71751 -8.06538,3.29798 -8.89107,1.14625 -0.2853,-0.74348 0.63444,-3.90059 2.04387,-7.0158 1.40944,-3.11521 2.30826,-5.91836 1.99739,-6.22923 -1.47402,-1.47403 -5.20975,2.38356 -7.92283,8.18127 C 127.344,157.86205 126.38477,159 124.40574,159 122.84662,159 122,158.42516 122,157.36656 z m 73.78635,-3.55291 c 0.91512,-0.91512 0.81173,-1.60029 -0.45227,-2.99699 -0.90124,-0.99585 -1.60019,-3.162 -1.55323,-4.81365 0.11747,-4.13158 -0.55262,-3.7732 -2.91018,1.55645 -1.59157,3.59802 -1.76476,4.86322 -0.82132,6 1.45043,1.74766 4.12502,1.86617 5.737,0.25419 z m 4.02943,-9.09241 C 199.6421,143.49956 199.05,142.5 198.5,142.5 c -1.23708,0 -1.88591,4.05443 -1.01183,6.32273 0.59536,1.545 0.72507,1.537 1.64486,-0.10149 0.5492,-0.97831 0.85643,-2.77831 0.68275,-4 z m -43.76273,-9.15732 C 154.32376,133.48026 156.43493,130 159.42819,130 c 2.99266,0 3.84963,2.15835 1.93967,4.8852 -1.72469,2.46234 -3.63236,2.70595 -5.31481,0.67872 z');
        logo.set({ fill: 'red', opacity: 0.8, selectable: false, name: '#logo' });
        body = new fabric.Path('m 133,329.4463 c -10.175,-0.71887 -24.35,-2.02232 -31.5,-2.89656 -7.15,-0.87424 -16.6,-1.69307 -21,-1.81963 l -8,-0.23011 0.193885,-22 c 0.998758,-113.32866 0.818333,-139.91144 -1.041095,-153.38916 -1.015966,-7.36404 -1.690966,-16.54749 -1.5,-20.40766 0.436347,-8.82031 -1.019987,-9.65837 -5.173334,-2.97703 -2.726334,4.38575 -4.221268,5.48474 -14.574685,10.71444 -6.345211,3.20509 -11.879111,5.42963 -12.297555,4.94342 -0.418445,-0.4862 -2.953923,-4.03401 -5.634398,-7.88401 -2.680474,-3.85 -8.078857,-11.05 -11.996405,-16 -3.917549,-4.95 -8.136637,-10.77129 -9.375753,-12.93621 l -2.2529367,-3.9362 3.8261387,-3.244343 C 18.09682,92.784894 33.520564,84.825607 37.350959,84.64885 40.050778,84.524264 41.72675,83.195923 47.63239,76.5 64.196166,57.719684 74.992987,50.435868 82.357051,53.073838 85.097076,54.055375 86.525596,53.787425 93.5,50.983732 c 10.86099,-4.366089 12.53543,-4.817944 23.72585,-6.402509 8.43125,-1.193868 11.02687,-1.177575 19.5,0.122401 7.50728,1.151793 15.33548,1.380616 33.75319,0.98663 l 23.97903,-0.512953 15.52097,3.414261 c 27.80814,6.117162 26.14406,5.401066 37.4821,16.129523 5.52138,5.224516 12.51386,11.257638 15.53886,13.406938 3.025,2.149301 9.325,6.626081 14,9.948402 10.53769,7.488679 14,10.753131 14,13.199935 0,1.0462 -3.85808,6.02451 -8.57352,11.06291 -6.00825,6.41977 -9.52395,11.19553 -11.75,15.96135 l -3.17648,6.80061 -5.3267,-0.63215 c -2.92968,-0.34769 -7.65468,-1.71607 -10.5,-3.04085 -2.84531,-1.32478 -5.8483,-2.41085 -6.6733,-2.41349 -2.00111,-0.006 -5.94008,3.48878 -10.09868,8.96091 l -3.40132,4.47566 0.19493,11.52434 c 0.10721,6.33839 0.71282,19.84935 1.34579,30.02435 0.63297,10.175 1.52995,40.1 1.99329,66.5 0.78989,45.00665 1.40029,54.84262 3.94028,63.4934 0.56414,1.92137 1.02571,5.18387 1.02571,7.25 l 0,3.7566 -5.87427,0 c -3.23085,0 -7.84335,0.699 -10.25,1.55334 -12.7532,4.52727 -50.66209,5.73407 -90.87573,2.89296 z');
        body.set({ fill: 'green', opacity: 0.5, selectable: false, name: '#than' });
        border = new fabric.Path('m 149.5,330.44592 c -1.65,-0.18359 -10.875,-0.84475 -20.5,-1.46926 -9.625,-0.6245 -22,-1.76649 -27.5,-2.53774 -5.5,-0.77126 -14.10625,-1.41052 -19.125,-1.4206 L 73.25,325 72.618056,321.84028 c -0.34757,-1.73785 -0.426131,-3.36554 -0.17458,-3.61709 0.25155,-0.25155 14.767175,0.38283 32.256944,1.40972 C 126.42186,320.90827 149.494,321.5 177.5,321.5 c 41.15621,0 42.3839,-0.0758 60.74952,-3.74984 0.74514,-0.14907 1.37541,1.04042 1.55963,2.94343 0.33381,3.44827 0.35478,3.43834 -9.80915,4.6459 -1.925,0.22871 -7.55,1.42312 -12.5,2.65424 -8.06266,2.00529 -11.91615,2.26693 -37,2.5122 -15.4,0.15057 -29.35,0.12357 -31,-0.06 z M 30.748567,131.25 C 26.498546,125.3375 19.868302,116.225 16.014692,111 l -7.0065634,-9.5 2.7459354,-2.245033 c 1.510265,-1.234768 3.045881,-2.247268 3.412481,-2.25 0.366599,-0.0027 7.287903,9.303273 15.380675,20.680013 l 14.71413,20.68497 -2.241459,1.81503 C 41.787089,141.18324 40.260357,142 39.627155,142 c -0.633203,0 -4.628568,-4.8375 -8.878588,-10.75 z m 231.790503,2.81322 c -1.02411,-1.65705 3.1906,-11.02283 7.59503,-16.8774 2.35261,-3.1272 7.31008,-8.89865 11.01659,-12.82544 6.26892,-6.641463 6.84763,-7.019719 8.29422,-5.421256 0.8553,0.945096 1.55509,2.242816 1.55509,2.883826 0,0.64101 -3.79406,5.26527 -8.43124,10.27613 -4.96389,5.3639 -9.92133,11.9463 -12.05453,16.0058 -2.52741,4.80966 -4.19385,6.89512 -5.50974,6.89512 -1.03755,0 -2.14699,-0.42155 -2.46542,-0.93678 z M 150.1737,51.958712 C 141.98089,50.929946 128.0746,47.787649 123.5,45.93146 l -3,-1.21728 3.36934,-0.755199 c 1.94421,-0.435772 6.59688,-0.199605 11,0.558355 12.68991,2.184461 30.57538,2.791575 44.78167,1.520094 10.31095,-0.922844 14.0376,-0.911401 17.25644,0.05299 2.258,0.676511 3.94008,1.395381 3.73798,1.597487 -0.20211,0.202107 -4.93812,1.253488 -10.52448,2.336403 -12.11903,2.349273 -29.81799,3.206326 -39.94725,1.934404 z');
        border.set({ selectable: false, name: '#vien' });
        loadPattern('https://dl.kraken.io/web/99/065ef5143e818d119f3768490858f1/1.png', border);
        //render();
        paths = [logo, body, border];

        //process swatches
        var swatches = $('.swatch a');
        $(swatches).each(function () {
            var pattern = '[0-9]{1,}[\,][0-9]{1,}[\,][0-9]{1,}';
            if ($(this).attr('rel').match(pattern)) {
                var color = "rgba(" + $(this).attr('rel') + "," + 0.55 + ")";
                $(this).html('<span>' + $(this).html() + '</span>');
                $(this).find('span').css('background', color);
                if (navigator.appName == 'Microsoft Internet Explorer') {
                    color = $(this).attr('rel');
                    var colors = color.split(",");
                    color = "#" + colorToHex(colors);
                    $(this).find('span').css({ 'background-color': color });
                }
            } else {
                $(this).html('<span>' + $(this).html() + '</span>');
                $(this).find('span').css('background-image', 'url(' + $(this).attr("rel") + ')');
            }

        });

        // create tooltips showing color name on swatch hover
        $(swatches).hover(function (e) {
            e.preventDefault();
            var offsetX = $(this).offset().left - $(this).parent().offset().left;
            var offsetY = $(this).offset().top - $(this).parent().offset().top + 25;
            var text = $(this).attr('title');
            if ((navigator.appName != 'Microsoft Internet Explorer')) $(this).removeAttr('title');
            $(this).after('<div class="colorizer-tooltip"><div class="colorizer-pointer-up"><div class="colorizer-pointer-up-inner"></div></div><span class="colorizer-tooltip-text">' + text + '</span></div>');
            var offsetToolTip = ($('.colorizer-tooltip').width() / 2) - 12;
            $('.colorizer-tooltip').css({ 'left': offsetX - offsetToolTip, 'top': offsetY });
        }, function () {
            var text = $('.colorizer-tooltip-text').html();
            $(this).attr('title', text);
            $(".colorizer-tooltip").remove();
        });

        //rgb to hex
        function colorToHex(color) {
            var red = parseInt(color[0]);
            var green = parseInt(color[1]);
            var blue = parseInt(color[2]);
            var rgb = blue | (green << 8) | (red << 16);
            return rgb.toString(16);
        }

        $(swatches).click(function (e) {
            e.preventDefault();
            $(swatches).removeClass('active');
            $(this).addClass('active');
    
            var path = $(this).attr('href');
            var svg;
            for (var i = 0; i < paths.length; i++) {
                if (paths[i].name == path) {
                    svg = paths[i];
                }
            }
            var pattern = '[0-9]{1,}[\,][0-9]{1,}[\,][0-9]{1,}';
            if ($(this).attr('rel').match(pattern)) {
                var color = "rgba(" + $(this).attr('rel') + "," + 0.55 + ")";
                if (navigator.appName == 'Microsoft Internet Explorer') {
                    color = $(this).attr('rel');
                    var colors = color.split(",");
                    color = "#" + colorToHex(colors);
                }
                removeRender();
                loadColor(color, svg);
            } else {
                removeRender();
                var url = $(this).attr('rel');
                loadPattern(url, svg);
            }
    
        });
    }

    function loadColor(color, svg) {
        svg.fill = color;
        render();
    }

    function loadPattern(url, svg) {
        fabric.Image.fromURL(url, function (img) {
            //img.scaleToWidth(100);
            var patternSourceCanvas = new fabric.StaticCanvas();
            patternSourceCanvas.add(img);

            var pattern = new fabric.Pattern({
                source: function () {
                    patternSourceCanvas.setDimensions({
                        width: img.getWidth() + 0,
                        height: img.getHeight() + 0
                    });
                    return patternSourceCanvas.getElement();
                },
                repeat: 'repeat'
            });
            svg.fill = pattern;
            render();
        });
    }

    function removeRender() {
        canvas.remove(body);
        canvas.remove(border);
        canvas.remove(logo);
    }

    function render() {
        canvas.add(body);
        canvas.moveTo(body, 2);
        canvas.add(border);
        canvas.moveTo(border, 4);
        canvas.add(logo);
        canvas.moveTo(logo, 4);
    }